---
layout: post
title: "DDD"
subtitle: '架构-DDD简介'
author: "Kang"
date: 2023-4-6 19:51:07
header-img: "img/post-head-img/arthas.jfif"
catalog: true
tags:
  - 架构
  - DDD
---
### 阅读参考
- [DDD在携程订单实践](https://zhuanlan.zhihu.com/p/620103914)
- [DDD参考阅读](https://zhuanlan.zhihu.com/p/641295531?utm_id=0)  
## 架构
> 分布式架构，本质上就是化整为零，分而治之的思想。从业务角度去审视我们的系统，领域即问题域，通常是根据一个组织所处的行业进行识别，它基于业务的愿景，定义了系统要解决的现实问题的目标和范围。。
- 核心域：决定产品核心竞争力的子域
- 支撑域：实现核心域目标所需的，但重要程度不如核心域的子域，一般具备强烈的个性化需求
- 通用域：具有通用功能，可被多个子域使用的的是通用域。该子域所解决的问题一般是业界常见问题，有成熟的解决方案，可直接购买或简单修改来使用

### 界限上下文
限界上下文在《实现领域驱动设计》中，用了很大篇幅去讲，它有几个重要的意义：  
1. 限界上下文是领域概念的语言边界与业务边界: 在这个边界内，领域概念的内涵是清晰、无歧义的
2. 限界上下文是团队的工作边界: 组织边界与限界上下文对齐
3. 限界上下文是技术方案的实施边界: 在这个边界内，技术方案是独立自治的，业务逻辑不会落入不同技术边界的间隙

![领域设计-DDD-战略领域模型](https://raw.githubusercontent.com/kangzhihu/images/master/领域设计-DDD-战略领域模型.png)

### 领域设计

![领域设计](https://raw.githubusercontent.com/kangzhihu/images/master/领域设计.png)
领域设计的三个核心问题：  
问题一：这个战略核心域的名字是什么，它的目标是什么？  
问题二：这个战略核心域中包含哪些概念？  
问题三：这个核心域的支撑子域和通用子域是什么？  
&emsp;&emsp;梳理当前的业务域需要明确业务活动的影响范围，比如某个业务动作或者行为是否会触发下一个业务动作，这个动作（领域事件）的输入和输出是什么，是谁（实体）发出的什么动作（命令），触发了这个动作，这些我们都需要梳理清楚。 

下面是一个栗子：  
&emsp;&emsp;当用户下完订单之后，在仓储领域生成对应的货物拣货单，然后系统根据拣货单中商品给不同分区的仓内作业人员生成对应的拣货任务，作业人员根据对应的拣货任务进行货品的拣取，并放入相应的货物容器中。最终将所有订单商品在拣货完成后进行合流，进行校验，最终形成包裹再进行后续的配送流程。
![领域设计](https://raw.githubusercontent.com/kangzhihu/images/master/领域设计-聚合demo.png)  
&emsp;&emsp;那这个栗子中拣货单就是一个聚合根，后续的所有紧密业务关联方和事件形成一个界限上下文(聚合)，都是围绕这个展开作业。  

##### 战略与战术设计说明
![领域-两个层面设计](https://raw.githubusercontent.com/kangzhihu/images/master/领域设计-DDD.png)  
- 实体：当一个对象由其标识（而不是属性）区分时，这种对象称为实体。传统的数据建模大多是根据数据库范式设计的，每一个数据库表对应一个实体，实体是拥有唯一标识和状态，且具有生命周期的业务对象。实体通常代表着现实世界中的某个概念，实体与领域模型密切相关，它是领域模型中多个属性、操作或者行为的载体。  
  实体的代码形态一般有四种形态：
  + 失血模型：模型仅仅包含数据的定义和getter/setter方法，业务逻辑和应用逻辑都放到服务层中。这种类在Java中叫POJO。
  + 贫血模型：贫血模型中包含了一些业务逻辑，但不包含依赖持久层的业务逻辑。这部分依赖于持久层的业务逻辑将会放到服务层中。
  + 充血模型：充血模型中包含了所有的业务逻辑，包括依赖于持久层的业务逻辑。
  + 胀血模型：胀血模型就是把和业务逻辑不想关的其他应用逻辑（如授权、事务等）都放到领域模型中
- 值对象：用来描述实体的特征(属性)，一般只是用来在业务处理时承载数据，比如上下文；
- 聚合和聚合根：把一组有相同生命周期、在业务上不可分隔的实体和值对象放在一起考虑，只有根实体可以对外暴露引用，这个根实体就是聚合根  





